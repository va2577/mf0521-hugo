<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fixed-Percentage Money Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script> -->
  </head>
  <body>
    <header>
      <section class="hero is-primary">
        <div class="hero-body">
          <div class="container">
            <h1 class="title">
              Fixed-Percentage
            </h1>
            <h2 class="subtitle">
                Money Management (Vue.js)
            </h2>
          </div>
        </div>
      </section>
    </header>
    <main id="app">
      <form>
        <div class="field">
          <label class="label" for="capital">Capital</label>
          <div class="control">
            <input class="input" v-bind:class="validate('capital')" placeholder="1000000" type="number" v-model="capital" min="0" step="100" />
          </div>
        </div>
        <div class="field">
          <label class="label" for="risk">Risk</label>
          <div class="control">
            <input class="input" v-bind:class="validate('risk')" placeholder="0.01" type="number" v-model="risk" min="0.00" max="1.00" step="0.01" />
          </div>
        </div>
        <div class="field">
          <label class="label" for="jpy">JPY</label>
          <div class="control">
            <input class="input" v-bind:class="validate('jpy')" placeholder="1" type="number" v-model="jpy" min="0.00" step="0.01" />
          </div>
        </div>
      </form>
      <table class="table is-fullwidth is-hoverable is-striped">
        <thead>
          <tr>
            <th>Stop-Loss</th>
            <th>Units</th>
            <th>Lots</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="e in a">
            <td>{{ e.stopLoss }}</td>
            <td>{{ e.units }}</td>
            <td>{{ e.lots }}</td>
          </tr>
        </tbody>
      </table>
    </main>
    <footer class="footer">
      <div class="content has-text-centered">
          <p><a href="https://bulma.io/">Bulma</a></p>
          <p><a href="https://vuejs.org/">Vue.js</a></p>
        </div>
    </footer>
    <!-- development version, includes helpful console warnings -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
    <!-- production version, optimized for size and speed -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script>
      var app = new Vue({
        el: '#app',
        data: {
          capital: '1000000',
          risk: '0.01',
          jpy: '1'
        },
        methods: {
          isNaN_: s => s.length === 0 || isNaN(s),
          validate: function (x) {
            return this.isNaN_(this[x]) ? 'is-danger' : 'is-success'
          }
        },
        computed: {
          a: function () {
            const units = x => Math.floor((x.capital * x.risk) / (((x.jpy === 1 ? 0.01 : 0.0001) * x.jpy * x.stopLoss)))
            const lots = x => (Math.floor(x.units / 1000) / 100).toFixed(2)
            const o = ['capital', 'risk', 'jpy'].reduce((acc, cur) => Object.assign(acc, { [cur]: this[cur] }), {})
            return [...Array(100).keys()]
              .filter(x => x !== 0)
              .map(x => Object.assign({ stopLoss: x }, o))
              .filter(x => !Object.entries(x).some(([key, value]) => this.isNaN_(value)))
              .map(x => Object.entries(x).map(([key, value]) => ({ [key]: Number(value) })).reduce((acc, cur) => Object.assign(acc, cur), {}))
              .map(x => Object.assign({ units: units(x) }, x))
              .map(x => Object.assign({ lots: lots(x) }, x))
          }
        }
      })
    </script>
  </body>
</html>
